<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>筋肉タイピング - Touch Typing Game</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Hiragino Kaku Gothic Pro', 'ヒラギノ角ゴ Pro W3', 'Meiryo', 'メイリオ', sans-serif;
            background: linear-gradient(135deg, #f0e6ff, #ffe6f0, #e6fff0, #fff0e6, #e6f0ff);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .game-container {
            background: linear-gradient(135deg, rgba(255, 240, 255, 0.95), rgba(240, 255, 250, 0.95));
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(200, 150, 255, 0.2);
            max-width: 800px;
            width: 100%;
            text-align: center;
            position: relative;
            z-index: 2;
            border: 2px solid rgba(255, 200, 255, 0.3);
        }

        h1 {
            color: #8b5cf6;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 8px rgba(139, 92, 246, 0.3);
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .stat-box {
            background: linear-gradient(45deg, #ddd6fe, #fce7f3, #dcfce7, #fef3c7);
            padding: 15px 20px;
            border-radius: 20px;
            margin: 5px;
            min-width: 120px;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #7c3aed;
        }

        .stat-label {
            font-size: 0.9em;
            color: #a855f7;
            margin-top: 5px;
        }

        .word-display {
            background: linear-gradient(45deg, #f3e8ff, #fef7ff, #ecfdf5);
            border-radius: 25px;
            padding: 30px;
            margin: 30px 0;
            font-size: 2.5em;
            font-weight: bold;
            color: #6b21a8;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 2px;
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.15);
            border: 2px solid rgba(196, 181, 253, 0.3);
        }

        .romaji-display {
            font-size: 1.2em;
            color: #a855f7;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }

        .input-area {
            margin: 20px 0;
        }

        #typing-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.5em;
            border: 3px solid #c4b5fd;
            border-radius: 20px;
            outline: none;
            text-align: center;
            background: linear-gradient(45deg, #faf5ff, #f0fdf4);
            font-family: 'Courier New', monospace;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.1);
        }

        #typing-input:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 25px rgba(139, 92, 246, 0.4);
        }

        .correct {
            background: linear-gradient(45deg, #dcfce7, #f0fdf4) !important;
            border-color: #86efac !important;
            color: #065f46;
        }

        .incorrect {
            background: linear-gradient(45deg, #fecaca, #fee2e2) !important;
            border-color: #fca5a5 !important;
            color: #991b1b;
        }

        .buttons {
            margin: 20px 0;
        }

        button {
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .reset-button {
            background: linear-gradient(45deg, #c084fc, #ddd6fe);
            color: #581c87;
            border: 2px solid rgba(139, 92, 246, 0.3);
        }

        .reset-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
        }

        .bgm-button {
            background: linear-gradient(45deg, #fbbf24, #fde047);
            color: #92400e;
            border: 2px solid rgba(251, 191, 36, 0.3);
        }

        .bgm-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
        }

        .game-over {
            background: linear-gradient(45deg, #fef3c7, #fef7cd);
            border-radius: 25px;
            padding: 20px;
            margin: 20px 0;
            display: none;
            border: 2px solid rgba(251, 191, 36, 0.3);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.2);
            color: #92400e;
        }

        .progress-bar {
            background: linear-gradient(45deg, #e5e7eb, #f3f4f6);
            height: 10px;
            border-radius: 8px;
            overflow: hidden;
            margin: 10px 0;
            box-shadow: inset 0 2px 4px rgba(139, 92, 246, 0.1);
        }

        .progress-fill {
            background: linear-gradient(45deg, #8b5cf6, #a855f7, #c084fc);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
        }

        .heart {
            position: absolute;
            font-size: 24px;
            pointer-events: none;
            animation: float-heart 4s ease-out forwards;
            z-index: 1;
        }

        .feather {
            position: absolute;
            font-size: 20px;
            pointer-events: none;
            animation: float-feather 5s ease-out forwards;
            z-index: 1;
        }

        @keyframes float-heart {
            0% {
                opacity: 1;
                transform: translateY(0) translateX(0) rotate(0deg) scale(1);
                filter: hue-rotate(0deg) drop-shadow(0 0 10px #ff69b4);
            }
            25% {
                opacity: 0.9;
                transform: translateY(-80px) translateX(30px) rotate(90deg) scale(1.3);
                filter: hue-rotate(60deg) drop-shadow(0 0 15px #ff1493);
            }
            50% {
                opacity: 0.8;
                transform: translateY(-160px) translateX(-20px) rotate(180deg) scale(1.1);
                filter: hue-rotate(120deg) drop-shadow(0 0 20px #9370db);
            }
            75% {
                opacity: 0.6;
                transform: translateY(-240px) translateX(50px) rotate(270deg) scale(0.9);
                filter: hue-rotate(180deg) drop-shadow(0 0 25px #00bfff);
            }
            100% {
                opacity: 0;
                transform: translateY(-320px) translateX(-30px) rotate(360deg) scale(0.3);
                filter: hue-rotate(240deg) drop-shadow(0 0 30px #87ceeb);
            }
        }

        @keyframes float-feather {
            0% {
                opacity: 1;
                transform: translateY(0) translateX(0) rotate(0deg) scale(1);
                filter: hue-rotate(0deg) drop-shadow(0 0 8px #ffffff);
            }
            20% {
                opacity: 0.9;
                transform: translateY(-60px) translateX(-40px) rotate(45deg) scale(1.2);
                filter: hue-rotate(45deg) drop-shadow(0 0 12px #f0f8ff);
            }
            40% {
                opacity: 0.8;
                transform: translateY(-120px) translateX(60px) rotate(90deg) scale(1.4);
                filter: hue-rotate(90deg) drop-shadow(0 0 16px #e6e6fa);
            }
            60% {
                opacity: 0.7;
                transform: translateY(-180px) translateX(-30px) rotate(135deg) scale(1.1);
                filter: hue-rotate(135deg) drop-shadow(0 0 20px #dda0dd);
            }
            80% {
                opacity: 0.5;
                transform: translateY(-240px) translateX(80px) rotate(180deg) scale(0.8);
                filter: hue-rotate(180deg) drop-shadow(0 0 24px #98fb98);
            }
            100% {
                opacity: 0;
                transform: translateY(-300px) translateX(-50px) rotate(225deg) scale(0.4);
                filter: hue-rotate(225deg) drop-shadow(0 0 28px #ffb6c1);
            }
        }

        .hearts-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .aurora-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, 
                rgba(255, 182, 193, 0.1), 
                rgba(221, 160, 221, 0.1), 
                rgba(173, 216, 230, 0.1), 
                rgba(152, 251, 152, 0.1));
            animation: aurora-shimmer 8s ease-in-out infinite;
            z-index: 0;
            pointer-events: none;
        }

        @keyframes aurora-shimmer {
            0%, 100% {
                opacity: 0.3;
                transform: translateX(0);
            }
            25% {
                opacity: 0.6;
                transform: translateX(10px);
            }
            50% {
                opacity: 0.4;
                transform: translateX(-5px);
            }
            75% {
                opacity: 0.7;
                transform: translateX(8px);
            }
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .word-display {
                font-size: 2em;
                padding: 20px;
            }
            
            .game-stats {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>💪 筋肉タイピング 💪</h1>
        
        <div class="game-stats">
            <div class="stat-box">
                <div class="stat-number" id="timer">60</div>
                <div class="stat-label">残り時間(秒)</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="score">0</div>
                <div class="stat-label">スコア</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="wpm">0</div>
                <div class="stat-label">WPM</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="accuracy">100</div>
                <div class="stat-label">正確率(%)</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>

        <div class="word-display" id="word-display">
            <div>
                <div class="romaji-display" id="romaji-display">どれでもキーをタッチすると始まります</div>
                <div>筋肉タイピングゲーム</div>
            </div>
        </div>

        <div class="input-area">
            <input type="text" id="typing-input" placeholder="ここにローマ字を入力...">
        </div>

        <div class="buttons">
            <button class="reset-button" id="reset-button">リセット</button>
            <button class="bgm-button" id="bgm-button">🎵 BGM ON</button>
        </div>

        <div class="game-over" id="game-over">
            <h2>ゲーム終了！</h2>
            <p id="final-score">お疲れさまでした！</p>
        </div>
    </div>

    <div class="aurora-bg" id="aurora-bg"></div>
    <div class="hearts-container" id="hearts-container"></div>

    <script>
        class TypingGame {
            constructor() {
                this.words = [
                    { japanese: '大胸筋', romaji: 'daikyoukin' },
                    { japanese: '三角筋', romaji: 'sankakukin' },
                    { japanese: '上腕二頭筋', romaji: 'jouwannitoukin' },
                    { japanese: '上腕三頭筋', romaji: 'jouwansantoukin' },
                    { japanese: '前腕筋', romaji: 'zenwaankin' },
                    { japanese: '腹直筋', romaji: 'fukuchokukin' },
                    { japanese: '腹斜筋', romaji: 'fukushakin' },
                    { japanese: '大腿四頭筋', romaji: 'daitaishitoukin' },
                    { japanese: 'ハムストリング', romaji: 'hamusutoringu' },
                    { japanese: '大殿筋', romaji: 'daidenkin' },
                    { japanese: '広背筋', romaji: 'kouhaikin' },
                    { japanese: '僧帽筋', romaji: 'souboukin' },
                    { japanese: '脊柱起立筋', romaji: 'sekichuukiritsukin' },
                    { japanese: 'ふくらはぎ', romaji: 'fukurahagi' },
                    { japanese: '前脛骨筋', romaji: 'zenkeikotukin' },
                    { japanese: '棘上筋', romaji: 'kyokkakin' },
                    { japanese: '棘下筋', romaji: 'kyokkakin' },
                    { japanese: '小円筋', romaji: 'shouenkin' },
                    { japanese: '肩甲下筋', romaji: 'kenkokakin' },
                    { japanese: '腸腰筋', romaji: 'chouyoukin' }
                ];
                
                this.currentWordIndex = 0;
                this.score = 0;
                this.timeLeft = 60;
                this.isGameActive = false;
                this.typedCharacters = 0;
                this.correctCharacters = 0;
                this.gameTimer = null;
                this.currentInput = '';
                this.bgmPlaying = false;
                this.bgmAudio = null;
                this.lastValidInput = '';
                
                this.initializeElements();
                this.setupEventListeners();
                this.initializeBGM();
            }

            initializeElements() {
                this.wordDisplay = document.getElementById('word-display');
                this.romajiDisplay = document.getElementById('romaji-display');
                this.typingInput = document.getElementById('typing-input');
                this.timerDisplay = document.getElementById('timer');
                this.scoreDisplay = document.getElementById('score');
                this.wpmDisplay = document.getElementById('wpm');
                this.accuracyDisplay = document.getElementById('accuracy');
                this.resetButton = document.getElementById('reset-button');
                this.gameOverDiv = document.getElementById('game-over');
                this.finalScoreP = document.getElementById('final-score');
                this.progressBar = document.getElementById('progress');
                this.bgmButton = document.getElementById('bgm-button');
                this.heartsContainer = document.getElementById('hearts-container');
            }

            setupEventListeners() {
                this.resetButton.addEventListener('click', () => this.resetGame());
                this.bgmButton.addEventListener('click', () => this.toggleBGM());
                this.typingInput.addEventListener('input', (e) => this.handleInput(e));
                this.typingInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && this.isGameActive) {
                        this.checkWord();
                    } else if (!this.isGameActive && e.key.length === 1) {
                        this.startGame();
                    }
                });
                this.typingInput.addEventListener('focus', () => {
                    if (!this.isGameActive) {
                        this.startGame();
                    }
                });
                // 任意のキー入力でゲーム開始
                document.addEventListener('keydown', (e) => {
                    if (!this.isGameActive && e.key.length === 1) {
                        this.startGame();
                        this.typingInput.focus();
                    }
                });
            }

            startGame() {
                this.isGameActive = true;
                this.typingInput.disabled = false;
                this.typingInput.focus();
                this.gameOverDiv.style.display = 'none';
                
                this.shuffleWords();
                this.displayCurrentWord();
                this.startTimer();
            }

            shuffleWords() {
                for (let i = this.words.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.words[i], this.words[j]] = [this.words[j], this.words[i]];
                }
            }

            displayCurrentWord() {
                if (this.currentWordIndex < this.words.length) {
                    const currentWord = this.words[this.currentWordIndex];
                    this.wordDisplay.innerHTML = `
                        <div>
                            <div class="romaji-display">${currentWord.romaji}</div>
                            <div>${currentWord.japanese}</div>
                        </div>
                    `;
                } else {
                    this.currentWordIndex = 0;
                    this.shuffleWords();
                    this.displayCurrentWord();
                }
            }

            handleInput(e) {
                if (!this.isGameActive) return;
                
                const inputValue = e.target.value.toLowerCase();
                const currentWord = this.words[this.currentWordIndex];
                const targetRomaji = currentWord.romaji.toLowerCase();
                
                // 入力変換処理（fu=hu, cho=thoなど）
                const convertedInput = this.convertInput(inputValue);
                const normalizedInput = this.normalizeN(convertedInput);
                const normalizedTarget = this.normalizeN(targetRomaji);
                
                // 正しい入力かチェック
                if (normalizedTarget.startsWith(normalizedInput) || this.checkPartialInput(convertedInput, targetRomaji)) {
                    this.currentInput = convertedInput;
                    this.lastValidInput = convertedInput;
                    this.typedCharacters++;
                    this.typingInput.className = 'correct';
                    
                    if (normalizedInput === normalizedTarget) {
                        this.correctWord();
                    }
                } else {
                    // タイプミスの場合、入力を最後の正しい状態に戻す
                    e.target.value = this.lastValidInput;
                    this.typingInput.className = 'incorrect';
                    this.playErrorSound();
                    
                    // 短時間で赤色を解除
                    setTimeout(() => {
                        if (this.typingInput.className === 'incorrect') {
                            this.typingInput.className = this.lastValidInput ? 'correct' : '';
                        }
                    }, 200);
                }
            }

            convertInput(input) {
                // fu=hu, cho=tho などの変換
                return input
                    .replace(/hu/g, 'fu')
                    .replace(/tho/g, 'cho');
            }

            normalizeN(str) {
                // 「ん」の処理：nn→n に統一
                return str.replace(/nn/g, 'n');
            }

            checkPartialInput(input, target) {
                // 部分的な入力をチェック
                const convertedInput = this.convertInput(input);
                const inputWithN = convertedInput.replace(/nn/g, 'n');
                const targetWithN = target.replace(/nn/g, 'n');
                return targetWithN.startsWith(inputWithN);
            }

            correctWord() {
                this.score += 10;
                this.correctCharacters += this.currentInput.length;
                this.typingInput.value = '';
                this.currentInput = '';
                this.lastValidInput = '';
                this.typingInput.className = '';
                this.currentWordIndex++;
                this.displayCurrentWord();
                this.updateStats();
                this.createAngelic();
            }

            checkWord() {
                const currentWord = this.words[this.currentWordIndex];
                const normalizedInput = this.normalizeN(this.currentInput);
                const normalizedTarget = this.normalizeN(currentWord.romaji.toLowerCase());
                if (normalizedInput === normalizedTarget) {
                    this.correctWord();
                }
            }

            createAngelic() {
                // ハートを複数作成
                const hearts = ['💖', '💕', '😇', '💜', '🤍'];
                const feathers = ['🪶', '✨', '🌟', '☄️', '🌠'];
                
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('div');
                        heart.className = 'heart';
                        heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                        heart.style.left = (Math.random() * 80 + 10) + '%';
                        heart.style.top = '100%';
                        heart.style.color = `hsl(${Math.random() * 360}, 70%, 70%)`;
                        this.heartsContainer.appendChild(heart);
                        
                        setTimeout(() => {
                            if (heart.parentNode) {
                                heart.parentNode.removeChild(heart);
                            }
                        }, 4000);
                    }, i * 100);
                }
                
                for (let i = 0; i < 2; i++) {
                    setTimeout(() => {
                        const feather = document.createElement('div');
                        feather.className = 'feather';
                        feather.textContent = feathers[Math.floor(Math.random() * feathers.length)];
                        feather.style.left = (Math.random() * 80 + 10) + '%';
                        feather.style.top = '100%';
                        feather.style.color = `hsl(${Math.random() * 60 + 180}, 60%, 80%)`;
                        this.heartsContainer.appendChild(feather);
                        
                        setTimeout(() => {
                            if (feather.parentNode) {
                                feather.parentNode.removeChild(feather);
                            }
                        }, 5000);
                    }, i * 150);
                }
            }

            initializeBGM() {
                // かわいいメロディーを作成
                this.createCuteBGM();
            }

            createCuteBGM() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const melody = [261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88, 523.25]; // C, D, E, F, G, A, B, C
                    let currentNote = 0;
                    const gainNode = audioContext.createGain();
                    gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
                    gainNode.connect(audioContext.destination);
                    
                    const playMelody = () => {
                        if (!this.bgmPlaying) return;
                        
                        const oscillator = audioContext.createOscillator();
                        oscillator.type = 'square';
                        oscillator.frequency.setValueAtTime(melody[currentNote], audioContext.currentTime);
                        
                        const noteGain = audioContext.createGain();
                        noteGain.gain.setValueAtTime(0, audioContext.currentTime);
                        noteGain.gain.linearRampToValueAtTime(0.05, audioContext.currentTime + 0.01);
                        noteGain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);
                        
                        oscillator.connect(noteGain);
                        noteGain.connect(audioContext.destination);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                        
                        currentNote = (currentNote + 1) % melody.length;
                        
                        setTimeout(playMelody, 600);
                    };
                    
                    this.bgmAudio = {
                        audioContext: audioContext,
                        gainNode: gainNode,
                        playMelody: playMelody,
                        start: () => {
                            this.bgmPlaying = true;
                            playMelody();
                        },
                        stop: () => {
                            this.bgmPlaying = false;
                        }
                    };
                    
                    // 自動開始
                    this.bgmAudio.start();
                    this.bgmButton.textContent = '🔇 BGM OFF';
                    
                    // 効果音用のオーディオコンテキストを作成
                    this.effectAudioContext = audioContext;
                    
                } catch (e) {
                    console.log('Web Audio API not supported');
                }
            }

            playErrorSound() {
                if (!this.effectAudioContext) return;
                
                try {
                    const oscillator = this.effectAudioContext.createOscillator();
                    const gainNode = this.effectAudioContext.createGain();
                    
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(150, this.effectAudioContext.currentTime);
                    
                    gainNode.gain.setValueAtTime(0.1, this.effectAudioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, this.effectAudioContext.currentTime + 0.1);
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.effectAudioContext.destination);
                    
                    oscillator.start(this.effectAudioContext.currentTime);
                    oscillator.stop(this.effectAudioContext.currentTime + 0.1);
                } catch (e) {
                    console.log('Error sound failed');
                }
            }

            playGameOverSound() {
                if (!this.effectAudioContext) return;
                
                try {
                    // ドーン音を作成
                    const oscillator1 = this.effectAudioContext.createOscillator();
                    const oscillator2 = this.effectAudioContext.createOscillator();
                    const gainNode = this.effectAudioContext.createGain();
                    
                    oscillator1.type = 'sawtooth';
                    oscillator2.type = 'square';
                    oscillator1.frequency.setValueAtTime(80, this.effectAudioContext.currentTime);
                    oscillator2.frequency.setValueAtTime(120, this.effectAudioContext.currentTime);
                    
                    gainNode.gain.setValueAtTime(0.3, this.effectAudioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, this.effectAudioContext.currentTime + 1);
                    
                    oscillator1.connect(gainNode);
                    oscillator2.connect(gainNode);
                    gainNode.connect(this.effectAudioContext.destination);
                    
                    oscillator1.start(this.effectAudioContext.currentTime);
                    oscillator2.start(this.effectAudioContext.currentTime);
                    oscillator1.stop(this.effectAudioContext.currentTime + 1);
                    oscillator2.stop(this.effectAudioContext.currentTime + 1);
                } catch (e) {
                    console.log('Game over sound failed');
                }
            }

            toggleBGM() {
                if (!this.bgmAudio) return;
                
                if (this.bgmPlaying) {
                    this.bgmAudio.stop();
                    this.bgmButton.textContent = '🎵 BGM ON';
                } else {
                    this.bgmAudio.start();
                    this.bgmButton.textContent = '🔇 BGM OFF';
                }
            }

            startTimer() {
                this.gameTimer = setInterval(() => {
                    this.timeLeft--;
                    this.timerDisplay.textContent = this.timeLeft;
                    
                    // プログレスバーの更新
                    const progress = ((60 - this.timeLeft) / 60) * 100;
                    this.progressBar.style.width = progress + '%';
                    
                    if (this.timeLeft <= 0) {
                        this.endGame();
                    }
                    
                    this.updateStats();
                }, 1000);
            }

            updateStats() {
                this.scoreDisplay.textContent = this.score;
                
                // WPM計算 (1分間あたりの単語数)
                const timeElapsed = (60 - this.timeLeft) / 60;
                const wpm = timeElapsed > 0 ? Math.round((this.score / 10) / timeElapsed) : 0;
                this.wpmDisplay.textContent = wpm;
                
                // 正確率計算
                const accuracy = this.typedCharacters > 0 ? 
                    Math.round((this.correctCharacters / this.typedCharacters) * 100) : 100;
                this.accuracyDisplay.textContent = accuracy;
            }

            endGame() {
                this.isGameActive = false;
                clearInterval(this.gameTimer);
                this.typingInput.disabled = true;
                
                // BGMをドーン音で停止
                this.playGameOverSound();
                if (this.bgmAudio && this.bgmPlaying) {
                    this.bgmAudio.stop();
                    this.bgmButton.textContent = '🎵 BGM ON';
                }
                
                const wpm = Math.round((this.score / 10) / 1);
                const accuracy = this.typedCharacters > 0 ? 
                    Math.round((this.correctCharacters / this.typedCharacters) * 100) : 100;
                
                this.finalScoreP.innerHTML = `
                    最終スコア: ${this.score}点<br>
                    WPM: ${wpm}<br>
                    正確率: ${accuracy}%<br>
                    よく頑張りました！💪
                `;
                
                this.gameOverDiv.style.display = 'block';
            }

            resetGame() {
                this.isGameActive = false;
                clearInterval(this.gameTimer);
                
                this.currentWordIndex = 0;
                this.score = 0;
                this.timeLeft = 60;
                this.typedCharacters = 0;
                this.correctCharacters = 0;
                this.currentInput = '';
                
                this.typingInput.value = '';
                this.lastValidInput = '';
                this.typingInput.disabled = false;
                this.typingInput.className = '';
                this.gameOverDiv.style.display = 'none';
                this.progressBar.style.width = '0%';
                
                this.wordDisplay.innerHTML = `
                    <div>
                        <div class="romaji-display">どれでもキーをタッチすると始まります</div>
                        <div>筋肉タイピングゲーム</div>
                    </div>
                `;
                
                this.timerDisplay.textContent = '60';
                this.scoreDisplay.textContent = '0';
                this.wpmDisplay.textContent = '0';
                this.accuracyDisplay.textContent = '100';
            }
        }

        // ゲーム初期化
        window.addEventListener('DOMContentLoaded', () => {
            new TypingGame();
        });
    </script>
</body>
</html>「Vercelにデプロイしてください」
