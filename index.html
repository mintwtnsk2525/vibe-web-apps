<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á≠ãËÇâ„Çø„Ç§„Éî„É≥„Ç∞ - Touch Typing Game</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Hiragino Kaku Gothic Pro', '„Éí„É©„ÇÆ„ÉéËßí„Ç¥ Pro W3', 'Meiryo', '„É°„Ç§„É™„Ç™', sans-serif;
            background: linear-gradient(135deg, #f0e6ff, #ffe6f0, #e6fff0, #fff0e6, #e6f0ff);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .game-container {
            background: linear-gradient(135deg, rgba(255, 240, 255, 0.95), rgba(240, 255, 250, 0.95));
            border-radius: 30px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(200, 150, 255, 0.2);
            max-width: 800px;
            width: 100%;
            text-align: center;
            position: relative;
            z-index: 2;
            border: 2px solid rgba(255, 200, 255, 0.3);
        }

        h1 {
            color: #8b5cf6;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 8px rgba(139, 92, 246, 0.3);
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .stat-box {
            background: linear-gradient(45deg, #ddd6fe, #fce7f3, #dcfce7, #fef3c7);
            padding: 15px 20px;
            border-radius: 20px;
            margin: 5px;
            min-width: 120px;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: bold;
            color: #7c3aed;
        }

        .stat-label {
            font-size: 0.9em;
            color: #a855f7;
            margin-top: 5px;
        }

        .word-display {
            background: linear-gradient(45deg, #f3e8ff, #fef7ff, #ecfdf5);
            border-radius: 25px;
            padding: 30px;
            margin: 30px 0;
            font-size: 2.5em;
            font-weight: bold;
            color: #6b21a8;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            letter-spacing: 2px;
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.15);
            border: 2px solid rgba(196, 181, 253, 0.3);
        }

        .romaji-display {
            font-size: 1.2em;
            color: #a855f7;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }

        .input-area {
            margin: 20px 0;
        }

        #typing-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.5em;
            border: 3px solid #c4b5fd;
            border-radius: 20px;
            outline: none;
            text-align: center;
            background: linear-gradient(45deg, #faf5ff, #f0fdf4);
            font-family: 'Courier New', monospace;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.1);
        }

        #typing-input:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 25px rgba(139, 92, 246, 0.4);
        }

        .correct {
            background: linear-gradient(45deg, #dcfce7, #f0fdf4) !important;
            border-color: #86efac !important;
            color: #065f46;
        }

        .incorrect {
            background: linear-gradient(45deg, #fecaca, #fee2e2) !important;
            border-color: #fca5a5 !important;
            color: #991b1b;
        }

        .buttons {
            margin: 20px 0;
        }

        button {
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .reset-button {
            background: linear-gradient(45deg, #c084fc, #ddd6fe);
            color: #581c87;
            border: 2px solid rgba(139, 92, 246, 0.3);
        }

        .reset-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
        }

        .bgm-button {
            background: linear-gradient(45deg, #fbbf24, #fde047);
            color: #92400e;
            border: 2px solid rgba(251, 191, 36, 0.3);
        }

        .bgm-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
        }

        .game-over {
            background: linear-gradient(45deg, #fef3c7, #fef7cd);
            border-radius: 25px;
            padding: 20px;
            margin: 20px 0;
            display: none;
            border: 2px solid rgba(251, 191, 36, 0.3);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.2);
            color: #92400e;
        }

        .progress-bar {
            background: linear-gradient(45deg, #e5e7eb, #f3f4f6);
            height: 10px;
            border-radius: 8px;
            overflow: hidden;
            margin: 10px 0;
            box-shadow: inset 0 2px 4px rgba(139, 92, 246, 0.1);
        }

        .progress-fill {
            background: linear-gradient(45deg, #8b5cf6, #a855f7, #c084fc);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
        }

        .heart {
            position: absolute;
            font-size: 20px;
            color: #f472b6;
            pointer-events: none;
            animation: float-heart 3s ease-out forwards;
            z-index: 1;
        }

        @keyframes float-heart {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg) scale(1);
            }
            50% {
                opacity: 0.8;
                transform: translateY(-100px) rotate(180deg) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translateY(-200px) rotate(360deg) scale(0.5);
            }
        }

        .hearts-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .word-display {
                font-size: 2em;
                padding: 20px;
            }
            
            .game-stats {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üí™ Á≠ãËÇâ„Çø„Ç§„Éî„É≥„Ç∞ üí™</h1>
        
        <div class="game-stats">
            <div class="stat-box">
                <div class="stat-number" id="timer">60</div>
                <div class="stat-label">ÊÆã„ÇäÊôÇÈñì(Áßí)</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="score">0</div>
                <div class="stat-label">„Çπ„Ç≥„Ç¢</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="wpm">0</div>
                <div class="stat-label">WPM</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="accuracy">100</div>
                <div class="stat-label">Ê≠£Á¢∫Áéá(%)</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>

        <div class="word-display" id="word-display">
            <div>
                <div class="romaji-display" id="romaji-display">„Å©„Çå„Åß„ÇÇ„Ç≠„Éº„Çí„Çø„ÉÉ„ÉÅ„Åô„Çã„Å®Âßã„Åæ„Çä„Åæ„Åô</div>
                <div>Á≠ãËÇâ„Çø„Ç§„Éî„É≥„Ç∞„Ç≤„Éº„É†</div>
            </div>
        </div>

        <div class="input-area">
            <input type="text" id="typing-input" placeholder="„Åì„Åì„Å´„É≠„Éº„ÉûÂ≠ó„ÇíÂÖ•Âäõ...">
        </div>

        <div class="buttons">
            <button class="reset-button" id="reset-button">„É™„Çª„ÉÉ„Éà</button>
            <button class="bgm-button" id="bgm-button">üéµ BGM ON</button>
        </div>

        <div class="game-over" id="game-over">
            <h2>„Ç≤„Éº„É†ÁµÇ‰∫ÜÔºÅ</h2>
            <p id="final-score">„ÅäÁñ≤„Çå„Åï„Åæ„Åß„Åó„ÅüÔºÅ</p>
        </div>
    </div>

    <div class="hearts-container" id="hearts-container"></div>

    <script>
        class TypingGame {
            constructor() {
                this.words = [
                    { japanese: 'Â§ßËÉ∏Á≠ã', romaji: 'daikyoukin' },
                    { japanese: '‰∏âËßíÁ≠ã', romaji: 'sankakukin' },
                    { japanese: '‰∏äËÖï‰∫åÈ†≠Á≠ã', romaji: 'jouwannitoukin' },
                    { japanese: '‰∏äËÖï‰∏âÈ†≠Á≠ã', romaji: 'jouwansantoukin' },
                    { japanese: 'ÂâçËÖïÁ≠ã', romaji: 'zenwaankin' },
                    { japanese: 'ËÖπÁõ¥Á≠ã', romaji: 'fukuchokukin' },
                    { japanese: 'ËÖπÊñúÁ≠ã', romaji: 'fukushakin' },
                    { japanese: 'Â§ßËÖøÂõõÈ†≠Á≠ã', romaji: 'daitaishitoukin' },
                    { japanese: '„Éè„É†„Çπ„Éà„É™„É≥„Ç∞', romaji: 'hamusutoringu' },
                    { japanese: 'Â§ßÊÆøÁ≠ã', romaji: 'daidenkin' },
                    { japanese: 'Â∫ÉËÉåÁ≠ã', romaji: 'kouhaikin' },
                    { japanese: 'ÂÉßÂ∏ΩÁ≠ã', romaji: 'soucapkin' },
                    { japanese: 'ËÑäÊü±Ëµ∑Á´ãÁ≠ã', romaji: 'sekichukkiritsukin' },
                    { japanese: '„Åµ„Åè„Çâ„ÅØ„Åé', romaji: 'fukurahagi' },
                    { japanese: 'ÂâçËÑõÈ™®Á≠ã', romaji: 'zenkokotsukin' },
                    { japanese: 'Ê£ò‰∏äÁ≠ã', romaji: 'kyokujoukin' },
                    { japanese: 'Ê£ò‰∏ãÁ≠ã', romaji: 'kyokutakin' },
                    { japanese: 'Â∞èÂÜÜÁ≠ã', romaji: 'shouenkin' },
                    { japanese: 'ËÇ©Áî≤‰∏ãÁ≠ã', romaji: 'kenkokakin' },
                    { japanese: 'ËÖ∏ËÖ∞Á≠ã', romaji: 'chouyoukin' }
                ];
                
                this.currentWordIndex = 0;
                this.score = 0;
                this.timeLeft = 60;
                this.isGameActive = false;
                this.typedCharacters = 0;
                this.correctCharacters = 0;
                this.gameTimer = null;
                this.currentInput = '';
                this.bgmPlaying = false;
                this.bgmAudio = null;
                
                this.initializeElements();
                this.setupEventListeners();
                this.initializeBGM();
            }

            initializeElements() {
                this.wordDisplay = document.getElementById('word-display');
                this.romajiDisplay = document.getElementById('romaji-display');
                this.typingInput = document.getElementById('typing-input');
                this.timerDisplay = document.getElementById('timer');
                this.scoreDisplay = document.getElementById('score');
                this.wpmDisplay = document.getElementById('wpm');
                this.accuracyDisplay = document.getElementById('accuracy');
                this.resetButton = document.getElementById('reset-button');
                this.gameOverDiv = document.getElementById('game-over');
                this.finalScoreP = document.getElementById('final-score');
                this.progressBar = document.getElementById('progress');
                this.bgmButton = document.getElementById('bgm-button');
                this.heartsContainer = document.getElementById('hearts-container');
            }

            setupEventListeners() {
                this.resetButton.addEventListener('click', () => this.resetGame());
                this.bgmButton.addEventListener('click', () => this.toggleBGM());
                this.typingInput.addEventListener('input', (e) => this.handleInput(e));
                this.typingInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && this.isGameActive) {
                        this.checkWord();
                    } else if (!this.isGameActive && e.key.length === 1) {
                        this.startGame();
                    }
                });
                this.typingInput.addEventListener('focus', () => {
                    if (!this.isGameActive) {
                        this.startGame();
                    }
                });
                // ‰ªªÊÑè„ÅÆ„Ç≠„ÉºÂÖ•Âäõ„Åß„Ç≤„Éº„É†ÈñãÂßã
                document.addEventListener('keydown', (e) => {
                    if (!this.isGameActive && e.key.length === 1) {
                        this.startGame();
                        this.typingInput.focus();
                    }
                });
            }

            startGame() {
                this.isGameActive = true;
                this.typingInput.disabled = false;
                this.typingInput.focus();
                this.gameOverDiv.style.display = 'none';
                
                this.shuffleWords();
                this.displayCurrentWord();
                this.startTimer();
            }

            shuffleWords() {
                for (let i = this.words.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.words[i], this.words[j]] = [this.words[j], this.words[i]];
                }
            }

            displayCurrentWord() {
                if (this.currentWordIndex < this.words.length) {
                    const currentWord = this.words[this.currentWordIndex];
                    this.wordDisplay.innerHTML = `
                        <div>
                            <div class="romaji-display">${currentWord.romaji}</div>
                            <div>${currentWord.japanese}</div>
                        </div>
                    `;
                } else {
                    this.currentWordIndex = 0;
                    this.shuffleWords();
                    this.displayCurrentWord();
                }
            }

            handleInput(e) {
                if (!this.isGameActive) return;
                
                this.currentInput = e.target.value.toLowerCase();
                this.typedCharacters++;
                
                const currentWord = this.words[this.currentWordIndex];
                const targetRomaji = currentWord.romaji.toLowerCase();
                
                // „Äå„Çì„Äç„ÅÆÁâπÂà•Âá¶ÁêÜÔºàn„Åß„ÇÇnn„Åß„ÇÇÂèØÔºâ
                const normalizedInput = this.normalizeN(this.currentInput);
                const normalizedTarget = this.normalizeN(targetRomaji);
                
                // „É™„Ç¢„É´„Çø„Ç§„É†„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
                if (normalizedTarget.startsWith(normalizedInput) || this.checkPartialN(this.currentInput, targetRomaji)) {
                    this.typingInput.className = 'correct';
                    if (normalizedInput === normalizedTarget) {
                        this.correctWord();
                    }
                } else {
                    this.typingInput.className = 'incorrect';
                }
            }

            normalizeN(str) {
                // „Äå„Çì„Äç„ÅÆÂá¶ÁêÜÔºönn‚Üín „Å´Áµ±‰∏Ä
                return str.replace(/nn/g, 'n');
            }

            checkPartialN(input, target) {
                // ÈÉ®ÂàÜÁöÑ„Å™„Äå„Çì„Äç„ÅÆÂÖ•Âäõ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                const inputWithN = input.replace(/nn/g, 'n');
                const targetWithN = target.replace(/nn/g, 'n');
                return targetWithN.startsWith(inputWithN);
            }

            correctWord() {
                this.score += 10;
                this.correctCharacters += this.currentInput.length;
                this.typingInput.value = '';
                this.currentInput = '';
                this.typingInput.className = '';
                this.currentWordIndex++;
                this.displayCurrentWord();
                this.updateStats();
                this.createHeart();
            }

            checkWord() {
                const currentWord = this.words[this.currentWordIndex];
                const normalizedInput = this.normalizeN(this.currentInput);
                const normalizedTarget = this.normalizeN(currentWord.romaji.toLowerCase());
                if (normalizedInput === normalizedTarget) {
                    this.correctWord();
                }
            }

            createHeart() {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.textContent = 'üíñ';
                heart.style.left = Math.random() * 100 + '%';
                heart.style.top = '100%';
                this.heartsContainer.appendChild(heart);
                
                setTimeout(() => {
                    if (heart.parentNode) {
                        heart.parentNode.removeChild(heart);
                    }
                }, 3000);
            }

            initializeBGM() {
                // Web Audio API „Çí‰ΩøÁî®„Åó„Å¶Ê∞¥„ÅÆÈü≥„ÇíÁîüÊàê
                this.createWaterSound();
            }

            createWaterSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator1 = audioContext.createOscillator();
                    const oscillator2 = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    // Ê∞¥„ÅÆÈü≥„Å´Ëøë„ÅÑÂë®Ê≥¢Êï∞Ë®≠ÂÆö
                    oscillator1.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator2.frequency.setValueAtTime(400, audioContext.currentTime);
                    
                    oscillator1.type = 'sine';
                    oscillator2.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    
                    oscillator1.connect(gainNode);
                    oscillator2.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    this.bgmAudio = {
                        oscillators: [oscillator1, oscillator2],
                        gainNode: gainNode,
                        audioContext: audioContext,
                        start: () => {
                            oscillator1.start();
                            oscillator2.start();
                        },
                        stop: () => {
                            oscillator1.stop();
                            oscillator2.stop();
                        }
                    };
                } catch (e) {
                    console.log('Web Audio API not supported');
                }
            }

            toggleBGM() {
                if (!this.bgmAudio) return;
                
                if (this.bgmPlaying) {
                    this.bgmAudio.stop();
                    this.bgmButton.textContent = 'üéµ BGM ON';
                    this.bgmPlaying = false;
                    this.createWaterSound(); // Êñ∞„Åó„ÅÑ„Ç™„Éº„Éá„Ç£„Ç™„Ç≥„É≥„ÉÜ„Ç≠„Çπ„Éà„Çí‰ΩúÊàê
                } else {
                    this.bgmAudio.start();
                    this.bgmButton.textContent = 'üîá BGM OFF';
                    this.bgmPlaying = true;
                }
            }

            startTimer() {
                this.gameTimer = setInterval(() => {
                    this.timeLeft--;
                    this.timerDisplay.textContent = this.timeLeft;
                    
                    // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÅÆÊõ¥Êñ∞
                    const progress = ((60 - this.timeLeft) / 60) * 100;
                    this.progressBar.style.width = progress + '%';
                    
                    if (this.timeLeft <= 0) {
                        this.endGame();
                    }
                    
                    this.updateStats();
                }, 1000);
            }

            updateStats() {
                this.scoreDisplay.textContent = this.score;
                
                // WPMË®àÁÆó (1ÂàÜÈñì„ÅÇ„Åü„Çä„ÅÆÂçòË™ûÊï∞)
                const timeElapsed = (60 - this.timeLeft) / 60;
                const wpm = timeElapsed > 0 ? Math.round((this.score / 10) / timeElapsed) : 0;
                this.wpmDisplay.textContent = wpm;
                
                // Ê≠£Á¢∫ÁéáË®àÁÆó
                const accuracy = this.typedCharacters > 0 ? 
                    Math.round((this.correctCharacters / this.typedCharacters) * 100) : 100;
                this.accuracyDisplay.textContent = accuracy;
            }

            endGame() {
                this.isGameActive = false;
                clearInterval(this.gameTimer);
                this.typingInput.disabled = true;
                
                const wpm = Math.round((this.score / 10) / 1);
                const accuracy = this.typedCharacters > 0 ? 
                    Math.round((this.correctCharacters / this.typedCharacters) * 100) : 100;
                
                this.finalScoreP.innerHTML = `
                    ÊúÄÁµÇ„Çπ„Ç≥„Ç¢: ${this.score}ÁÇπ<br>
                    WPM: ${wpm}<br>
                    Ê≠£Á¢∫Áéá: ${accuracy}%<br>
                    „Çà„ÅèÈ†ëÂºµ„Çä„Åæ„Åó„ÅüÔºÅüí™
                `;
                
                this.gameOverDiv.style.display = 'block';
            }

            resetGame() {
                this.isGameActive = false;
                clearInterval(this.gameTimer);
                
                this.currentWordIndex = 0;
                this.score = 0;
                this.timeLeft = 60;
                this.typedCharacters = 0;
                this.correctCharacters = 0;
                this.currentInput = '';
                
                this.typingInput.value = '';
                this.typingInput.disabled = false;
                this.typingInput.className = '';
                this.gameOverDiv.style.display = 'none';
                this.progressBar.style.width = '0%';
                
                this.wordDisplay.innerHTML = `
                    <div>
                        <div class="romaji-display">„Å©„Çå„Åß„ÇÇ„Ç≠„Éº„Çí„Çø„ÉÉ„ÉÅ„Åô„Çã„Å®Âßã„Åæ„Çä„Åæ„Åô</div>
                        <div>Á≠ãËÇâ„Çø„Ç§„Éî„É≥„Ç∞„Ç≤„Éº„É†</div>
                    </div>
                `;
                
                this.timerDisplay.textContent = '60';
                this.scoreDisplay.textContent = '0';
                this.wpmDisplay.textContent = '0';
                this.accuracyDisplay.textContent = '100';
            }
        }

        // „Ç≤„Éº„É†ÂàùÊúüÂåñ
        window.addEventListener('DOMContentLoaded', () => {
            new TypingGame();
        });
    </script>
</body>
</html>